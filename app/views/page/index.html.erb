<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<div class="row row-deck g-4">
  <div class="col-md-6">
    <div class="card">
      <div class="card-status-top bg-azure"></div>
      <div class="card-body">
        <h1 class="display-4 mb-4">
          <%= @message_count %>
        </h1>
        <h2 class="card-title">Messages</h2>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-status-top bg-azure"></div>
      <div class="card-body">
        <h1 class="display-4 mb-4">
          <%= @app_count %>
        </h1>
        <h2 class="card-title">Apps</h2>
      </div>
    </div>
  </div>
  <div class="col-md-12">
    <div class="card">
      <div class="card-status-top bg-azure"></div>
      <div class="card-body">
        <div id="chart-demo-line" class="position-relative "></div>
      </div>
    </div>
  </div>
</div>

<script>
    const data = <%= @graph_data.to_json.html_safe %>;

    document.addEventListener("DOMContentLoaded", function() {
        window.ApexCharts && (new ApexCharts(document.getElementById(
            'chart-demo-line'), {
            chart: {
                type: "line",
                fontFamily: 'inherit',
                height: 260,
                parentHeightOffset: 0,
                toolbar: {
                    show: false,
                },
                animations: {
                    enabled: false
                },
            },
            stroke: {
                width: 2,
                lineCap: "round",
                curve: "straight",
            },
            series: [{
                name: "Errors",
                data: data.errors
            }, {
                name: "Warnings",
                data: data.warnings
            }, {
                name: "Others",
                data: data.others
            }],
            tooltip: {
                theme: 'light'
            },
            grid: {
                padding: {
                    top: -20,
                    right: 0,
                    left: -4,
                    bottom: -4
                },
                strokeDashArray: 4,
            },
            xaxis: {
                labels: {
                    padding: 0,
                },
                tooltip: {
                    enabled: false
                },
                type: 'datetime',
            },
            yaxis: {
                labels: {
                    padding: 4
                },
            },
            labels: data.labels,
            colors: [
                'red',
                'orange',
                'lightblue'
            ],
            legend: {
                show: true,
                position: 'bottom',
                offsetY: 12,
                markers: {
                    width: 10,
                    height: 10,
                    radius: 100,
                },
                itemMargin: {
                    horizontal: 8,
                    vertical: 8
                },
            },
        })).render();
    });
</script>