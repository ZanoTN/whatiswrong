<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<div class="row row-deck g-4">
  <div class="col-md-6">
    <div class="card">
      <div class="card-status-top bg-azure"></div>
      <div class="card-body">
        <h1 class="display-4">
          <%= @message_count %>
        </h1>
        <h2 class="card-title">Messages</h2>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-status-top bg-azure"></div>
      <div class="card-body">
        <h1 class="display-4">
          <%= @app_count %>
        </h1>
        <h2 class="card-title">Apps</h2>
      </div>
    </div>
  </div>
  <div class="col-md-12">
    <div class="card">
      <div class="card-status-top bg-azure"></div>
      <div class="card-body">
        <div id="chart-root-page" class="position-relative"></div>
      </div>
    </div>
  </div>
</div>

<script>
    const data = <%= @graph_data.to_json.html_safe %>;
    const theme = '<%= @theme.html_safe %>';

    document.addEventListener("DOMContentLoaded", function() {
        window.ApexCharts && (new ApexCharts(document.getElementById(
            'chart-root-page'), {
            chart: {
                type: "bar",
                fontFamily: 'inherit',
                height: 240,
                parentHeightOffset: 0,
                toolbar: {
                    show: false,
                },
                animations: {
                    enabled: false
                },
                stacked: true,
            },
            plotOptions: {
                bar: {
                    columnWidth: '50%',
                }
            },
            dataLabels: {
                enabled: false
            },
            series: [{
                name: "Errors",
                data: data.errors
            }, {
                name: "Warnings",
                data: data.warnings
            }, {
                name: "Others",
                data: data.others
            }],
            tooltip: {
                theme: theme
            },
            grid: {
                padding: {
                    top: -20,
                    right: 0,
                    left: -4,
                    bottom: -4
                },
                strokeDashArray: 4,
                borderColor: theme === "dark" ? "#444" : "#e0e0e0"
            },
            xaxis: {
                labels: {
                    padding: 0,
                    style: {
                        colors: theme === "dark" ? "#d0d0d0" : "#333"
                    }
                },
                tooltip: {
                    enabled: false
                },
                type: 'datetime',
            },
            yaxis: {
                labels: {
                    padding: 4,
                    style: {
                        colors: theme === "dark" ? "#d0d0d0" : "#333"
                    }
                },
            },
            labels: data.labels,
            colors: [
                'rgb(214,57,57)',
                'rgb(245,159,0)',
                'rgb(66,153,225)'
            ],
            legend: {
                labels: {
                    colors: theme === "dark" ? "#d0d0d0" : "#333"
                },
                show: true,
                position: 'bottom',
                offsetY: 12,
                markers: {
                    width: 10,
                    height: 10,
                    radius: 100,
                },
                itemMargin: {
                    horizontal: 10,
                    vertical: 10
                },
            },
        })).render();
    });
</script>