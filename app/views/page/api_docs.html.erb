<h2 class="page-title"><%= t("custom.api_docs.title") %></h2>

<div class="card mt-4" data-controller="highlight">
  <div class="card-status-top bg-azure"></div>
  <div class="card-header">
    <h3 class="mb-0"><%= t("custom.api_docs.title_endpoint") %></h3>
  </div>

  <div class="card-body">
    <p>
      <%= t("custom.api_docs.description_endpoint_1") %>
      <code class="language-none"><%= @app_url %>/api/v1/message</code>
      <%= t("custom.api_docs.description_endpoint_2") %>
    </p>

    <pre class="p-0"><code class="bg-body-tertiary text-body language-json">{
    "key": "YOUR_API_KEY",
    "level": "error" | "warning" | "info",
    "message": "Error message describing the issue",
    "backtrace": "Optional backtrace or stack trace information", // JSON or plain text
    "context": "Optional context information (e.g., user ID, request URL)", // JSON or plain text
    "occurred_at": "2025-12-23T16:12:24+00:00" // ISO 8601 format
}</code></pre>
  </div>
</div>

<div class="card mt-4" data-controller="highlight">
  <div class="card-status-top bg-azure"></div>
  <div class="card-header">
    <h3 class="mb-0"><%= t("custom.api_docs.title_examples") %></h3>
  </div>

  <div class="card-body">
  <h4 class="">Curl:</h4>
  <pre class="p-0"><code class="bg-body-tertiary text-body language-bash">curl --location --request PUT '<%= @app_url %>/api/v1/message' \
--header 'Content-Type: application/json' \
--data '{
    "key": "<%= @key || 'YOUR_API_KEY' %>",
    "level": "error",
    "message": "MESSAGE_TEST",
    "backtrace": "BACKTRACE_TEST",
    "context": "CONTEXT_TEXT",
    "occurred_at": "2025-12-23T16:12:24+00:00"
}'</code></pre>

  <h4 class="mt-3">JavaScript (Express.js):</h4>
  <pre class="p-0"><code class="bg-body-tertiary text-body language-javascript">app.use((err, req, res, next) => {
  fetch("<%= @app_url %>/api/v1/message", {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      key: "<%= @key || 'YOUR_API_KEY' %>",
      level: "error",
      message: err.message,
      backtrace: err.stack,
      context: req.originalUrl,
      occurred_at: new Date().toISOString()
    })
  }).catch(() => {});

  res.status(500).end();
});</code></pre>

  <h4 class="mt-3">Ruby on Rails:</h4>
  <pre class="p-0"><code class="bg-body-tertiary text-body language-ruby">class ApplicationController < ActionController::Base
  rescue_from StandardError, with: :handle_error

  private

  def handle_error(error)
    Faraday.put("<%= @app_url %>/api/v1/message") do |req|
      req.headers["Content-Type"] = "application/json"
      req.body = {
        key: "<%= @key || 'YOUR_API_KEY' %>",
        level: "error",
        message: error.message,
        backtrace: error.backtrace,
        context: request.fullpath,
        occurred_at: Time.now.utc.iso8601
      }.to_json
    end

    head :internal_server_error
  end
end
  </code></pre>

  <h4 class="mt-3">C++ (ESP32):</h4>
  <pre class="p-0"><code class="bg-body-tertiary text-body language-cpp">void sendError(String message, String backtrace = "") {
  if(WiFi.status() != WL_CONNECTED) return;

  HTTPClient http;
  http.begin("<%= @app_url %>/api/v1/message");
  http.addHeader("Content-Type", "application/json");

  String payload = "{";
  payload += "\"key\":\"<%= @key || 'YOUR_API_KEY' %>\",";
  payload += "\"level\":\"error\",";
  payload += "\"message\":\"" + message + "\",";
  payload += "\"backtrace\":\"" + backtrace + "\",";
  payload += "\"context\":\"ESP32\",";
  payload += "\"occurred_at\":\"" + String(millis()) + "\"";
  payload += "}";

  int httpResponseCode = http.PUT(payload);
  Serial.println("HTTP Response: " + String(httpResponseCode));

  http.end();
}</code></pre>
  </div>
</div>
